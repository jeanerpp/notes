* root
** PSA
   Tom [2:52 PM]
   bugReports PSA PR is submitted at https://github.west.isilon.com/isilon/tech-doc/pull/409

   Tom [3:11 PM]
   for PSA or DDD:
   https://github.west.isilon.com/isilon/tech-doc

   1. install texStudio
   2. put isialpha.bst, isi-article.cls, isi-extensions.sty into the dir where you put your .tex file
   3. edit the .text using texStudio and build into PDF
   4. fork isilon/tech-doc, upload your .tex and pdf files and submit PR
   5. PSA sample: https://github.west.isilon.com/isilon/tech-doc/pull/409/files#diff-b87a6ebb229dc3e4789060e17b6869dd
      DDD sample: https://github.west.isilon.com/isilon/tech-doc/tree/master/DDD/engineering_automation/saltstack
   @here above is PSA/DDD process
** leankit
   Leankit req:
   https://isilon.leankit.com/card/688274532
   https://isilon.leankit.com/card/688249838
** Patch
   Run correlation module test:
   correlation $ PYTHONPATH=. python -m pytest tests
   staging: spog-staging.west.isilon.com patch-automation-db-prod01.west.isilon.com
** update prod env
   ~/.pypirc
   upload command: python setup.py sdist bdist_wheel register -r isilon upload -r isilon

   1. cd /var/www/spog
   2. . venv/bin/activate
   3. pip uninstall spog
   4. pip uninstall patch_workflow_tools
   5. pip install patch_workflow_tools
   6. pip install spog
   7. systemctl restart httpd
*** DONE Bug 234284 - Correlation job miss files
    CLOSED: [2018-08-02 Thu 18:05]
    - State "DONE"       from "TODO"       [2018-08-02 Thu 18:05]
    - State "TODO"       from              [2018-08-02 Thu 17:55]
*** DONE Bug 230871 - Correlation did not find following difference
    CLOSED: [2018-08-02 Thu 18:05]
    - State "DONE"       from "TODO"       [2018-08-02 Thu 18:05]
    - State "TODO"       from              [2018-08-02 Thu 18:04]


*** DONE Bug 234363 - patch correlation should include meaningful manual page changes
    CLOSED: [2018-11-12 Mon 14:45]

    - State "DONE"       from "TODO"       [2018-11-12 Mon 14:45]
    - State "TODO"       from              [2018-08-03 Fri 10:02]
*** TODO Bug 234298 - PR failed right after kicking off the "Roll Patch"
    - State "TODO"       from              [2018-08-03 Fri 10:03]
*** DONE Bug 231474 - Patch Automation can't skip services restarting test even if the services are not selected in "Manual Svcs"
    CLOSED: [2018-11-12 Mon 14:45]
    - State "DONE"       from "TODO"       [2018-11-12 Mon 14:45]
    - State "TODO"       from              [2018-08-03 Fri 10:03]
*** DONE Bug 233838 - Patch mechanics test should handle the case of adding new service process
    CLOSED: [2018-11-12 Mon 14:45]
    - State "DONE"       from "TODO"       [2018-11-12 Mon 14:45]
    - State "TODO"       from              [2018-08-03 Fri 10:04]
*** DONE Bug 229650 - Failed job due to description mismatch
    CLOSED: [2018-11-12 Mon 14:45]
    - State "DONE"       from "TODO"       [2018-11-12 Mon 14:45]
    - State "TODO"       from              [2018-08-03 Fri 10:04]
** github
   # rebase with commit
   git remote add upstream git@github.west.isilon.com:IME-Patch/correlation.git
   git pull upstream master
  
   git fetch upstream
   git merge upstream/master

   # rebase without commit
   git remote add upstream git@github.west.isilon.com:IME-Patch/workflow_tools.git
   git fetch upstream
   git rebase upstream/master

** buildweb api
   dforrest [11:51 PM]
   @jian xu @ctabor Here¡¯s the only Buildweb API docs I¡¯m aware of https://wiki.west.isilon.com/index.php?title=Buildweb_API
   Unfortunately it¡¯s woefully out of date and contains much outdated/misleading/completely wrong information.  Or, if you know a little Django, you can checkout the list of all endpoints here: https://github.west.isilon.com/eng-automation/buildweb/blob/master/urls.py.  The endpoints you will probably want to use are queue_custom_testmgr or queue_regression.  DM me with specific questions and I can walk you through how to use them for your tasks.
** elasticsearch
   URL search:
   http://elasticsearch.elk.apps.isilon.com:9200/regression_wheel_dashboard/test_info/_search

   Syntax in Kibana dev tools:
   GET regression_wheel_dashboard/test_info/_search
   {
     "query": {
       "match_all": {}
     },
     "aggs": {
       "tests_by_branch": {
         "terms": {
           "field": "branch",
           "size": 10
         }
       }
     }
   }
  
   PUT regression_wheel_dashboard/_mapping/test_info
   {
     "properties": {
       "branch": { 
         "type":     "text",
         "fielddata": true
       }
     }
   }
  
   #get error 402:
   GET regression_wheel_dashboard/test_info/_search
   {
     "query": {
       "match_all": {}
     },
     "aggs": {
       "tests_by_branch": {
                   "date_histogram": {
                       "field": "queue_time",
                       "interval": 100
                   },
                   "aggs": {
                       "group_by_user": {
                           "terms": {
                               "field": "queued_by",
                               "show_term_doc_count_error": true,
                               "shard_size": 100,
                               "size": 100
                           }
                       }
                   }
               }
       }
   }
  
  
   {
       "query": {
           "bool": {
               "must": [
                   {
                       "range": {
                           "start_time": {
                               "gte": "2018-06-01T00:00:00", "lte": "2018-06-02T00:00:00"
                                   }
                       }
                   },
                   {
                       "terms": {
                           "status":
                               ["Build System Exception", "Did Not Launch", "Died Unexpectedly", "Failed", "Setup Failure", "Stopped", "Stopping", "Unhandled Exception", "User Stopped", "Succeeded", "Queued", "Running", "Assigned", "Stopping"]
                               }
                   }
                   ]
                   }
       },
           "size": 9999
   }
  
  
  
   GET regression_wheel_dashboard/test_info/_search
   {
           "size": 9999,
           "query": {
             "bool": {
               "must": [
                 {
                   "range": {
                     "start_time": {
                         "gte": "2018-06-01T00:00:00",
                         "lte": "2018-06-02T00:00:00"
                     }
                   }
                 },
                 {
                       "terms": {
                           "status": [ "Build System Exception"]
                       }
                 }              
               ]
             }
           }
   }
  
   GET regression_wheel_dashboard/test_info/_search
   {
           "size": 9999,
           "query": {
             "bool": {
               "must": [
                 {
                   "range": {
                     "start_time": {
                         "gte": "2018-06-01T00:00:00",
                         "lte": "2018-06-08T00:00:00"
                     }
                   }
                 },
                 {
                       "terms": {
                           "status.keyword": ["Setup Failure", "Succeeded"]
                       }
                 }              
               ]
             }
           }
   }
** vagrant on centos 7
   # install packages
   curl -k https://releases.hashicorp.com/vagrant/2.1.2/vagrant_2.1.2_x86_64.rpm -o vagrant_2.1.2_x86_64.rpm
   rpm -i vagrant_2.1.2_x86_64.rpm
   # need to disable secure sign in repo config:
   wget http://download.virtualbox.org/virtualbox/rpm/rhel/virtualbox.repo
   yum install VirtualBox-5.2
   # install corresponding kernel head then setup virtualbox driver
   uname -r
   yum install kernel-devel-3.10.0-862.3.2.el7.x86_64
   yum install kernel-headers-3.10.0-862.3.2.el7.x86_64
   rcvboxdrv setup
   # disable secure vagrant box download
   config.vm.box_download_insecure = true
** DB access
   bugzilla: mysql -h eng-sea-bugsdb02.west.isilon.com -u bugreports -pzippy bugs42
   buildweb: mysql -h builddb.west.isilon.com -u readonly build
   machinedb: psql -h machinedb02.prod.sea1.west.isilon.com -U readonly -d machine
** github op for patch
   git clone git@github.west.isilon.com:xjian/onefs.git
   git remote add ime-patch git@github.west.isilon.com:IME-Patch/Patches.git
   git fetch ime-patch
   git checkout remotes/ime-patch/BR_BUG_PATCH_232710_PROD
   git checkout -b BR_BUG_PATCH_233180
   git cherry-pick 1e0f3fc4386b10ae002d83a2712546989ec5a979 # if we want additional modification
   git push origin BR_BUG_PATCH_233180
** bugreports
*** how to count bug according data range
    File "/usr/lib/python2.7/site-packages/flask/app.py", line 1598, in dispatch_request
    return self.view_functions[rule.endpoint](**req.view_args)
    File "/home/xujian/dev/bugreport/bugreports/bugreports/bp.py", line 216, in report
    content = report_mappings[name](**data)
    File "/home/xujian/dev/bugreport/bugreports/bugreports/releases/pipeline.py", line 112, in generate
    report_section('report_triage'),
    File "/home/xujian/dev/bugreport/bugreports/bugreports/release_dashboard.py", line 571, in generate
    res = generate_guts(**config)
    File "/home/xujian/dev/bugreport/bugreports/bugreports/release_dashboard.py", line 584, in generate_guts
    abd(bd)
    File "/home/xujian/dev/bugreport/bugreports/bugreports/release_dashboard.py", line 293, in analyze_bugsdb
    analyze_bugs_activity(bd)
    File "/home/xujian/dev/bugreport/bugreports/bugreports/release_dashboard.py", line 213, in analyze_bugs_activity
    get_activity()
    File "/home/xujian/dev/bugreport/bugreports/bugreports/profiling.py", line 15, in timed
    result = method(*args, **kw)
    File "/home/xujian/dev/bugreport/bugreports/bugreports/release_dashboard.py", line 208, in get_activity
    who, bug_when, field, added, removed)
    File "/home/xujian/dev/bugreport/bugreports/bugreports/models.py", line 1225, in process_change
    self.process_to(when, when.date())
    File "/home/xujian/dev/bugreport/bugreports/bugreports/models.py", line 1181, in process_to
    self.process_transitions_to_time(to_time, to_date)
    File "/home/xujian/dev/bugreport/bugreports/bugreports/models.py", line 1150, in process_transitions_to_time
    self.tabulate_transitions(self.last_update_date)

** DONE plan for patch tool transfer
   CLOSED: [2018-11-12 Mon 14:45] DEADLINE: <2018-08-29 Wed>
   - State "DONE"       from "TODO"       [2018-11-12 Mon 14:45]
** DONE new dashboard
   CLOSED: [2018-11-12 Mon 14:47] DEADLINE: <2018-09-15 Sat>
   - State "DONE"       from "TODO"       [2018-11-12 Mon 14:47]
** DONE need white file list in patch maker
   CLOSED: [2018-11-12 Mon 14:46]
   - State "DONE"       from "TODO"       [2018-11-12 Mon 14:46]
** TODO dashboard RW/build/DT
   - end to end of alarming and trouble shooting.
   - learn from isilon dashboard.
   - test running vs hardware status, ask heavily on illustration/analysis of background data/status.
   - https://github.west.isilon.com/eng-tools/zabbix-monitoring-docs/blob/master/questionnaires/jenkins-questionnaire.md
** TODO new problem
   There¡¯s a bug viewing XML: https://spog.west.isilon.com/services/patch-automation/xml?patch_id=191367
   and README https://spog.west.isilon.com/services/patch-automation/readme/draft?patch=191367
   - State "TODO"       from              [2018-11-12 Mon 15:03]
** DONE COI session
   CLOSED: [2018-11-13 Tue 14:25]
   - State "DONE"       from "TODO"       [2018-11-13 Tue 14:25]
   - State "TODO"       from              [2018-11-12 Mon 15:04]
   - exammple: query_es.py, ck_cert.py
   - Github op: pull/push/fork, squish/force
** TODO patch db to github design
   The extraction of git data from the api is in the workflow_tools package, which is already a dependency
   in the same `patch-pdk-entrypoints` branch
   https://github.west.isilon.com/ctabor/spog/blob/patch-git-workflow/spog/services/patch_automation/bp.py#L86
   https://github.west.isilon.com/ctabor/spog/blob/patch-git-workflow/spog/services/patch_automation/bp.py#L461

   https://github.west.isilon.com/ctabor/workflow_tools/blob/patch-pdk-entrypoints/patch_automation/pdk/git.py#L17
   fairly straightforward
